<div class="chat-container">
  <!-- Left Sidebar: Rooms List -->
  <aside class="sidebar rooms-list">
    <div class="sidebar-header">
      <h3>Rooms</h3>
    </div>
    <!-- 
      USE THE NEW COMPONENT HERE 
      - Pass the rooms data down using [rooms]
      - Pass the selected room ID down using [selectedRoomId]
      - Listen for the selection event with (roomSelected)
    -->
    <!-- THIS IS THE CORRECTED CODE -->
    <app-room-list
      [rooms]="rooms$ | async"
      [selectedRoomId]="selectedRoom?.roomId ?? null"
    >
      (roomSelected)="selectRoom($event)">
    </app-room-list>
  </aside>

  <!-- Main Chat Area -->
  <main class="chat-area">
    <header class="chat-header">
      <!-- Show selected room name or a default message -->
      <h4>{{ selectedRoom?.roomName || 'Select a Room' }}</h4>
      <span *ngIf="!selectedRoom">Select a room to start messaging.</span>
    </header>

    <!-- ... -->
    <div class="message-area" #messageArea>
      <div *ngFor="let msg of messages" class="message-item">
        <div
          class="message"
          [class.sent]="isMessageSent(msg)"
          [class.received]="!isMessageSent(msg)"
          [class.sending]="msg.status === 'sending'"
        >
          <!-- ... message content ... -->
        </div>
      </div>
    </div>
    <!-- ... -->

    <footer class="chat-input-area">
      <!-- Bind the form's submit event to our sendMessage() method -->
      <form class="message-form" (ngSubmit)="sendMessage()">
        <!-- 
      Use [(ngModel)] for two-way data binding.
      The input is disabled if no room is selected.
    -->
        <input
          type="text"
          placeholder="Type your message here..."
          class="message-input"
          [(ngModel)]="newMessageText"
          name="messageText"
          [disabled]="!selectedRoom"
          autocomplete="off"
        />

        <!-- The button is also disabled if no room is selected -->
        <button
          type="submit"
          class="send-button"
          [disabled]="!selectedRoom || !newMessageText.trim()"
        >
          Send
        </button>
      </form>
    </footer>
  </main>

  <!-- Right Sidebar: Users List -->
  <aside class="sidebar users-list">
    <div class="sidebar-header">
      <h3>Users</h3>
    </div>
    <!-- 
      USE THE NEW COMPONENT HERE 
      - Pass the users data down using [users]
      - Listen for the selection event with (userSelected)
    -->
    <app-users-list
      [users]="(users$ | async)"
      (userSelected)="createAndSelectPrivateRoom($event)">
    </app-users-list>
  </aside>
</div>
